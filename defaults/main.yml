---
# slurm.conf parameters. Only those which are non-default values are given here. These duplicate the stackhpc.openhpc defaults.
slurm_config:
  ClusterName: "{{ slurm_cluster_name }}"
  SlurmUser: slurm
  StateSaveLocation: /var/spool/slurm
  ProctrackType: proctrack/pgid
  SlurmctldParameters:
    - enable_configless
  SlurmctldTimeout: 300
  SlurmdTimeout: 300
  SelectType: select/cons_res
  SelectTypeParameters: CR_Core
  PriorityType: priority/multifactor
  PriorityWeightPartition: 1000
  PreemptType: preempt/partition_prio
  PreemptMode:
    - SUSPEND
    - GANG
  # logging
  SlurmctldSyslogDebug: info
  SlurmdSyslogDebug: info
  # ACCOUNTING
  JobAcctGatherType: "{{ slurm_job_acct_gather_type }}"
  JobAcctGatherFrequency: "{{ slurm_job_acct_gather_frequency }}"
  JobCompType: "{{ slurm_job_comp_type }}"
  JobCompLoc: "{{ slurm_job_comp_loc }}"
  AccountingStorageType: "{{ slurm_accounting_storage_type }}"
  AccountingStorageHost: "{{ slurm_accounting_storage_host }}"
  AccountingStoragePort: "{{ slurm_accounting_storage_port }}"
  AccountingStoragePass: "{{ slurm_accounting_storage_pass }}"
  AccountingStorageUser: "{{ slurm_accounting_storage_user }}"
  
  ReturnToService: 2

slurm_login_nodes: [] # TODO: support groups here too

slurm_service_enabled: true
slurm_service_started: "{{ slurm_service_enabled }}"
# openhpc_slurm_service:
openhpc_slurm_control_host: "{{ inventory_hostname }}"
openhpc_slurm_partitions: []
openhpc_cluster_name:
openhpc_job_maxtime: '60-0' # quote this to avoid ansible converting some formats to seconds, which is interpreted as minutes by Slurm

# Accounting
slurm_accounting_storage_host: "{{ openhpc_slurmdbd_host }}"
slurm_accounting_storage_port: 6819
slurm_accounting_storage_type: accounting_storage/none
# NOTE: You only need to set these if using accounting_storage/mysql
slurm_accounting_storage_user: slurm
slurm_accounting_storage_pass:

# Job accounting
slurm_job_acct_gather_type: jobacct_gather/linux
slurm_job_acct_gather_frequency: 30
slurm_job_comp_type: jobcomp/none
slurm_job_comp_loc: /var/log/slurm_jobacct.log

# slurmdbd configuration
openhpc_slurmdbd_host: "{{ openhpc_slurm_control_host }}"
openhpc_slurmdbd_port: "{{ openhpc_slurm_accounting_storage_port }}"
openhpc_slurmdbd_mysql_host: "{{ openhpc_slurm_control_host }}"
openhpc_slurmdbd_mysql_database: slurm_acct_db
#openhpc_slurmdbd_mysql_password:
openhpc_slurmdbd_mysql_username: slurm

slurm_munge_key:

# Auto detection
# openhpc_ram_multiplier: 0.95
