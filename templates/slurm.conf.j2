# Parameters
{% for hostname in query('vars', 'slurm_control_hosts') %}
SlurmctldHost={{ hostname }}
{% endfor %}

{% for key, value in slurm_config.items() %}
{% if value != None %}{{ key }}={{ value | to_comma_list }}{# can use missing values like "Key: " to skip templating key/value entirely #}

{% endif %}
{% endfor %}

# LOGIN-ONLY NODES
{% for login in slurm_login_nodes %}
NodeName={{ login }}
{% endfor %}

# COMPUTE NODES & PARITITIONS
{% for partition in slurm_partitions %}
    {% set nodelist = [] %}
    {% for hostlist in (partition.nodes | hostlist_expression) %}
NodeName={{ hostlist }} State=UNKNOWN
    {% set _ = nodelist.append(hostlist) %}
    {% endfor %}
    {% if not nodelist %}
NodeName=n/a
    {% endif %}
PartitionName={{ partition.name }} State=UP Nodes={{ nodelist | join(',') }}
{% endfor %}

